<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimeTracker</title>
  <link href="http://localhost:8080/css/style.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
</head>

<body class="bg-blue-100">
  <nav class="bg-gray-800 text-gray-100" x-data="{ menuOpen: false}">
    <div class="gb-white shadow mb-10">
      <div class="max-w-3xl mx-auto py-3 px-6 md:px-0 md:flex md:justify-between md:items-center">
        <div class="flex justify-between items-center">
          <div class="flex items-center">
            <a href="#" class="text-xl hover:text-gray-300 ml-4">TimeTracker</a>
          </div>
          <!-- Mobile Menu-->
          <div class="flex md:hidden">
            <button type="button" @click="menuOpen = !menuOpen"
              class="text-gray-400 hover:text-gray-300 focus:outline-none focus:text-gray-200" aria-label="toggle menu">
              <svg class="fill-current h-6 w-8" view-box="0 0 24 24">
                <rect width="36" height="4" rx="1"></rect>
                <rect y="10" width="36" height="4" rx="1"></rect>
                <rect y="20" width="36" height="4" rx="1"></rect>
              </svg>
            </button>
          </div>
        </div>
        <div :class="menuOpen ? 'show' : 'hidden'" class="md:flex items-center md:mt-0 mt-4 md:block">
          <div class="flex flex-col md:flex-row md:ml-6">
            <a class="my-1 text-sm font-medium hover:text-gray-300 md:mx-4 md:my-0" href="#">Home</a>
            <a class="my-1 text-sm font-medium hover:text-gray-300 md:mx-4 md:my-0" href="#">Search</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- New Item-->
  <section class="bg-white max-w-3xl mx-auto rounded p-6 my-3" x-data="newForm()" x-init="init">
    <form method="POST" x-on:submit.prevent="submitData($dispatch)">
      <div class="grid grid-cols-2">
        <p class="text-2xl text-gray-200" x-text="now.day"></p>
        <p class="text-6xl place-self-end" x-text="now.time"></p>
      </div>
      <input type="text" x-model="formData.comment">
      <p x-text="message"></p>
      <button class="bg-green-600 rounded p-6 my-3 text-xl" type="submit">Add</button>
    </form>
    <script>
      function newForm() {
        return {
          formData: {
            id: null,
            tag: "Tag",
            start: moment(),
            end: null,
            comment: "Comment"
          },
          now: {
            day: "12. April 2021",
            time: "14:39:00"
          },
          message: "",
          init() {
            setInterval(() => {
              this.formData.start = moment();
              this.now.day = moment().format("DD. MMMM YY");
              this.now.time = moment().format("LTS");
            }, 500);
          },
          submitData(dispatch) {
            const data = {
              "start": "1970-01-01T00:00:00.002Z",
              "end": "1970-01-01T00:00:00.004Z",
              "category": null,
              "tag": "Tag",
              "comment": "Something"
            };
            const post = async () => {
              this.message = "Saving...";
              await axios.post("/api/time-records/", data
              ).then(response => {
                this.formData = response.data;
                this.message = "Saved";
                dispatch('reload-items', {});
              }).catch(error => console.log("ERROR", error.response.data));
            }
            post();
          }
        }
      };
    </script>
  </section>

  <!-- Itemlist -->
  <section @reload-items.window="loadItems()" class="max-w-3xl mx-auto md:items-center" x-data="itemList()"
    x-init="init">
    <template x-for="item in items" :key="item">
      <div class="p-6 bg-white rounded my-3">
        <div class="px-1">
          <small x-text="item.start"></small>
        </div>
      </div>
    </template>

  </section>
  <script>
    function itemList() {
      return {
        items: [],
        loadItems() {
          console.log("REFETCH");
          const get = async () => {
            axios.get("/api/time-records/"
            ).then(response => {
              console.log(response);
              this.items = response.data;
            }).catch(error => console.log("ERROR", error.response.data))
          };
          get();
        },
      }
    }
    function init() {
      this.loadItems();
    }
  </script>
</body>

</html>